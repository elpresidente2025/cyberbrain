React Hook useGenerateAPI ì½”ë“œ ë¦¬ë·° ìš”ì²­
// frontend/src/hooks/useGenerateAPI.js - ì™„ì „ ìˆ˜ì •ëœ ìµœì¢… ë²„ì „

import { useState, useCallback } from 'react';
import { httpsCallable } from 'firebase/functions';
import { functions } from '../services/firebase';
import { callHttpFunction } from '../services/firebaseService';
import { useAuth } from './useAuth';

export function useGenerateAPI() {
  const { user } = useAuth();
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);
  const [drafts, setDrafts] = useState([]);
  const [attempts, setAttempts] = useState(0);
  
  const maxAttempts = 3;

  // Firebase ì˜ˆì—´ í•¨ìˆ˜ (ìµœì í™”ë¥¼ ìœ„í•´ ìœ ì§€)
  const preloadFirebase = useCallback((formData) => {
    const totalLength = (formData.topic?.length || 0) + (formData.keywords?.length || 0);
    if (totalLength > 2) {
      import('firebase/functions');
      import('../services/firebase');
    }
  }, []);

  // ğŸ†• ë©”íƒ€ë°ì´í„° ì¶•ì  ë° ë¶„ì„ í•¨ìˆ˜ (ì„ì‹œ ë¹„í™œì„±í™”)
  const collectMetadata = useCallback(async (draft) => {
    try {
      console.log('ğŸ“Š ë©”íƒ€ë°ì´í„° ìˆ˜ì§‘ ì‹œì‘ (ë¹„í™œì„±í™”):', draft.title);
      
      // ë©”íƒ€ë°ì´í„° í•¨ìˆ˜ê°€ ë°±ì—”ë“œì— ì—†ìœ¼ë¯€ë¡œ ì„ì‹œ ë¹„í™œì„±í™”
      // const collectMetadata = httpsCallable(functions, 'collectMetadata');
      return null; // ë°”ë¡œ ë°˜í™˜
      
      /* ì„ì‹œ ë¹„í™œì„±í™”
      const metadataPackage = {
        // ì›ê³  ê¸°ë³¸ ì •ë³´
        contentData: {
          title: draft.title,
          content: draft.content,
          wordCount: draft.wordCount,
          category: draft.category,
          subCategory: draft.subCategory,
          keywords: draft.keywords
        },
        
        // AI ìƒì„± ë©”íƒ€ë°ì´í„°
        aiMetadata: draft.meta || {},
        
        // ì‚¬ìš©ì ì„ íƒ í–‰ë™ ë°ì´í„°
        userBehavior: {
          generatedAt: draft.generatedAt,
          selectedStyle: draft.style,
          selectedType: draft.type,
          isFirstChoice: attempts === 1 // ì²« ì‹œë„ì—ì„œ ì„ íƒí–ˆëŠ”ì§€
        },
        
        // ì„±ê³¼ ì¶”ì ìš©
        performanceMetrics: {
          generationAttempt: attempts,
          totalVariations: 3, // ê¸°ë³¸ 3ê°œ ìƒì„±
          selectedVariationIndex: 0 // ì²« ë²ˆì§¸ ì„ íƒ
        }
      };
      
      const result = await collectMetadata(metadataPackage);
      
      if (result.data?.success) {
        console.log('âœ… ë©”íƒ€ë°ì´í„° ìˆ˜ì§‘ ì™„ë£Œ:', result.data.insights);
        return result.data.insights; // í•™ìŠµëœ ì¸ì‚¬ì´íŠ¸ ë°˜í™˜
      }
      */
      
    } catch (error) {
      console.warn('âš ï¸ ë©”íƒ€ë°ì´í„° ìˆ˜ì§‘ ì‹¤íŒ¨ (ê¸°ëŠ¥ì—ëŠ” ì˜í–¥ ì—†ìŒ):', error.message);
    }
    
    return null;
  }, [attempts]);

  // HTML íƒœê·¸ ì œê±° ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
  const stripHtmlTags = useCallback((html) => {
    if (!html) return '';
    return html
      .replace(/<[^>]*>/g, '')  // HTML íƒœê·¸ ì œê±°
      .replace(/&nbsp;/g, ' ')  // &nbsp; â†’ ê³µë°±
      .replace(/&amp;/g, '&')   // &amp; â†’ &
      .replace(/&lt;/g, '<')    // &lt; â†’ <
      .replace(/&gt;/g, '>')    // &gt; â†’ >
      .replace(/&quot;/g, '"')  // &quot; â†’ "
      .trim();
  }, []);

  // HTML ë Œë”ë§ìš© ì •ë¦¬ í•¨ìˆ˜
  const sanitizeHtml = useCallback((html) => {
    if (!html) return '';
    // ê¸°ë³¸ì ì¸ HTML íƒœê·¸ë§Œ í—ˆìš© (ë³´ì•ˆìƒ í•„ìš”ì‹œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš© ê¶Œì¥)
    return html
      .replace(/<script[^>]*>.*?<\/script>/gi, '') // ìŠ¤í¬ë¦½íŠ¸ ì œê±°
