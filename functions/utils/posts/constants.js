'use strict';

/**
 * 사용자 상태별 설정
 */
const STATUS_CONFIG = {
  '현역': {
    guideline: '현역 의원으로서 경험과 성과를 바탕으로 신뢰있는 내용을 포함하세요. 실제 의정활동 경험을 언급하는게 좋습니다.',
    title: '의원'
  },
  '후보': {
    guideline: '후보로서 정책과 공약을 중심으로 신뢰있는 내용을 작성하세요. 미래 비전과 구체적 계획을 제시하세요',
    title: '후보'
  },
  '예비': {
    guideline: '예비후보로서 정책과 공약을 중심으로 신뢰있는 내용을 작성하세요. 미래 비전과 구체적 계획을 제시하세요',
    title: '예비후보'
  },
  '준비': {
    guideline: '준비 상태에서는 어떤 호칭도 사용하지 않고 개인 이름으로만 지칭하세요. 정치 활동 준비 과정이나 지역 현안에 대한 관심, 개인적 견해를 표현하세요. "의원", "후보" 같은 표현을 사용하지 마세요.',
    title: ''
  }
};

/**
 * 카테고리 → 작법(writingMethod) 매핑
 */
const CATEGORY_TO_WRITING_METHOD = {
  'daily-communication': 'emotional_writing',
  'activity-report': 'direct_writing',
  'policy-proposal': 'logical_writing',
  'current-affairs': 'critical_writing',
  'local-issues': 'analytical_writing'
};

/**
 * 정책 이름 매핑
 */
const POLICY_NAMES = {
  economy: '경제정책',
  education: '교육정책',
  welfare: '복지정책',
  environment: '환경정책',
  security: '안보정책',
  culture: '문화정책'
};

/**
 * 가족 상태 매핑
 */
const FAMILY_STATUS_MAP = {
  '미혼': '싱글 생활의 경험을 가진',
  '기혼(자녀 있음)': '자녀 양육 가정의 경험을 가진',
  '기혼(자녀 없음)': '가정을 꾸리며',
  '한부모': '한부모 가정의 경험을 가진'
};

/**
 * 배경 경력 관련성 키워드
 */
const CAREER_RELEVANCE = {
  '교육자': ['교육', '학생', '학교', '교사'],
  '사업가': ['경제', '중소상공인', '영업', '창업'],
  '공무원': ['행정', '정책', '공공서비스'],
  '의료인': ['의료', '건강', '코로나', '보건'],
  '법조인': ['법', '제도', '정의', '권리']
};

/**
 * 정치 경험 매핑
 */
const POLITICAL_EXPERIENCE_MAP = {
  '초선': '초선 의원으로서 신선한 관점에서',
  '재선': '의정 경험을 바탕으로',
  '3선이상': '다선 의정 경험으로',
  '정치 신인': '새로운 시각에서'
};

/**
 * 위원회 키워드 매핑
 */
const COMMITTEE_KEYWORDS = {
  '교육위원회': ['교육', '학생', '학교', '대학'],
  '보건복지위원회': ['복지', '의료', '건강', '연금'],
  '국토교통위원회': ['교통', '주거', '도로', '건설'],
  '환경노동위원회': ['환경', '노동', '일자리'],
  '여성가족위원회': ['여성', '가족', '육아', '출산']
};

/**
 * 지역 연고 매핑
 */
const LOCAL_CONNECTION_MAP = {
  '토박이': '지역 토박이로서',
  '오래 거주': '오랫동안 이 지역에 거주해',
  '이주민': '이 지역에서 새로운 삶을 시작한 고향으로 일구',
  '귀농': '고향으로 돌아온'
};

/**
 * 선거법 준수 표현 규칙 (3단계)
 * 1단계: 예비후보 등록 이전 (준비, 현역)
 * 2단계: 예비후보 등록 이후 (예비)
 * 3단계: 본 후보 등록 이후 (후보)
 */
const ELECTION_EXPRESSION_RULES = {
  // 1단계: 예비후보 등록 이전
  STAGE_1: {
    applies_to: ['준비', '현역'],
    description: '예비후보 등록 이전 - 일반 정치인, 당직자, 현역 의원/단체장',
    forbidden: {
      // 신분 관련 - 정규식 패턴
      status: [
        /예비\s*후보/g,
        /출마\s*예정/g,
        /[가-힣]+이\s*되겠습니다/g,  // "○○시장이 되겠습니다"
      ],
      // 공약성 표현
      pledge: [
        /공약을?\s*(발표|제시|말씀)/g,
        /공약\s*사항/g,
        /공약입니다/g,
        /[0-9]+\s*번째\s*공약/g,
        /첫\s*번째\s*공약/g,
        /두\s*번째\s*공약/g,
        /세\s*번째\s*공약/g,
        /약속\s*드립니다/g,
        /약속\s*드리겠습니다/g,
        /약속\s*하겠습니다/g,
        /반드시\s*실현/g,
        /꼭\s*실현/g,
        /당선\s*되면/g,
        /당선\s*후에?/g,
        /당선되어/g,
      ],
      // 지지 호소
      support: [
        /지지해?\s*주십시오/g,
        /지지를?\s*부탁/g,
        /지지와\s*참여/g,
        /함께해?\s*주십시오/g,
        /선택해?\s*주십시오/g,
        /지원\s*부탁/g,
        /투표해?\s*주십시오/g,
        /한\s*표\s*부탁/g,
      ],
      // 선거 직접 언급
      election: [
        /다음\s*선거/g,
        /[0-9]{4}년\s*(지방)?선거/g,
        /재선을?\s*위해/g,
        /선거\s*준비/g,
        /출마\s*준비/g,
      ]
    },
    // 자동 치환 규칙 (forbidden → replacement)
    replacements: {
      '공약': '정책 방향',
      '공약을 발표': '정책 방향을 제안',
      '공약을 제시': '정책 방향을 제안',
      '공약 사항': '정책 제안 사항',
      '첫 번째 공약': '첫 번째 정책 제안',
      '두 번째 공약': '두 번째 정책 제안',
      '세 번째 공약': '세 번째 정책 제안',
      '약속드립니다': '이 방향으로 노력하겠습니다',
      '약속 드립니다': '이 방향으로 노력하겠습니다',
      '약속드리겠습니다': '이 방향으로 노력하겠습니다',
      '약속하겠습니다': '이 방향으로 노력하겠습니다',
      '반드시 실현': '실현될 수 있도록 노력',
      '꼭 실현': '실현될 수 있도록 노력',
      '당선되면': '이 정책이 실현된다면',
      '당선 후': '향후',
      '당선되어': '힘을 모아',
      '지지해 주십시오': '관심 가져 주십시오',
      '지지를 부탁': '관심을 부탁',
      '지지와 참여를 부탁': '관심과 성원을 부탁',
      '지지와 참여': '관심과 성원',
      '함께해 주십시오': '함께 고민해 주십시오',
      '선택해 주십시오': '관심 가져 주십시오',
      '투표해 주십시오': '관심 가져 주십시오',
      '다음 선거': '앞으로',
      '재선을 위해': '더 나은 지역을 위해',
      '선거 준비': '정책 연구',
      '출마 준비': '정책 연구',
      '예비후보': '',  // 삭제
      '출마 예정': '정치 활동 중인',
    },
    // 프롬프트에 주입할 지시문
    promptInstruction: `
[⚠️ 선거법 준수 - 예비후보 등록 이전 단계]
현재 상태에서는 선거법상 다음 표현을 사용할 수 없습니다.

** 절대 금지 표현 **
❌ "공약", "공약을 발표합니다", "○번째 공약"
❌ "약속드립니다", "약속하겠습니다", "반드시 실현하겠습니다"
❌ "당선되면 ○○하겠습니다", "당선 후에"
❌ "지지해 주십시오", "함께해 주십시오", "선택해 주십시오"
❌ "투표해 주십시오", "지지를 부탁드립니다"
❌ "다음 선거에서", "2026년 지방선거에서", "재선을 위해"
❌ "예비후보", "후보", "출마 예정자"

** 반드시 사용할 대체 표현 **
✅ "공약" → "정책 방향", "비전", "정책 제안"
✅ "약속드립니다" → "이 방향으로 노력하겠습니다", "연구하고 있습니다"
✅ "당선되면" → "이 정책이 실현된다면"
✅ "지지 부탁" → "관심 부탁드립니다"

** 사용 가능한 표현 **
"정책 방향을 제안합니다"
"비전을 공유드립니다"
"이런 방향의 정책을 연구하고 있습니다"
"논의를 이어가겠습니다"
"정책 제안을 드립니다"
`
  },

  // 2단계: 예비후보 등록 이후
  STAGE_2: {
    applies_to: ['예비'],
    description: '예비후보 등록 이후 - 선관위 등록 완료',
    forbidden: {
      // 본후보 전용 표현만 금지
      fullCandidateOnly: [
        /투표해?\s*주십시오/g,
        /저를\s*선택해?\s*주십시오/g,
        /기호\s*[0-9]+번/g,  // 아직 기호 없음
      ]
    },
    replacements: {
      '투표해 주십시오': '지지해 주십시오',
      '저를 선택해 주십시오': '함께해 주십시오',
    },
    promptInstruction: `
[선거법 준수 - 예비후보 단계]
예비후보로서 대부분의 선거 표현이 가능합니다.

✅ 사용 가능: "공약", "약속드립니다", "당선되면", "지지해 주십시오"
❌ 아직 불가: "투표해 주십시오" (선거기간에만 가능)
`
  },

  // 3단계: 본 후보 등록 이후 (선거기간)
  STAGE_3: {
    applies_to: ['후보'],
    description: '본 후보 등록 이후 - 선거기간',
    forbidden: {
      // 불법 표현만 금지
      illegal: [
        /금품/g,
        /향응/g,
        /돈을?\s*드리/g,
      ]
    },
    replacements: {},
    promptInstruction: `
[선거법 준수 - 정식 후보 단계]
대부분의 선거운동 표현이 가능합니다.
❌ 금지: 금품/향응 제공 암시, 허위사실 유포
`
  }
};

/**
 * 상태에 해당하는 선거법 단계 반환
 * @param {string} status - 사용자 상태 (준비/현역/예비/후보)
 * @returns {Object|null} 해당 단계의 규칙
 */
function getElectionStage(status) {
  for (const [stageName, stage] of Object.entries(ELECTION_EXPRESSION_RULES)) {
    if (stage.applies_to && stage.applies_to.includes(status)) {
      return { name: stageName, ...stage };
    }
  }
  return null;
}

module.exports = {
  STATUS_CONFIG,
  CATEGORY_TO_WRITING_METHOD,
  POLICY_NAMES,
  FAMILY_STATUS_MAP,
  CAREER_RELEVANCE,
  POLITICAL_EXPERIENCE_MAP,
  COMMITTEE_KEYWORDS,
  LOCAL_CONNECTION_MAP,
  ELECTION_EXPRESSION_RULES,
  getElectionStage
};
