/**
 * functions/prompts/builders/title-generation.js
 * ë„¤ì´ë²„ ë¸”ë¡œê·¸ ì œëª© ìƒì„± í”„ë¡¬í”„íŠ¸ (7ê°€ì§€ ì½˜í…ì¸  êµ¬ì¡° ê¸°ë°˜)
 *
 * í•µì‹¬ ì›ì¹™:
 * - 25ì ì´ë‚´ (ë„¤ì´ë²„ ê²€ìƒ‰ê²°ê³¼ ìµœì í™”)
 * - ì½˜í…ì¸  êµ¬ì¡°(ìœ í˜•) ê¸°ë°˜ ë¶„ë¥˜ (ë„ë©”ì¸ X)
 * - AEO(AI ê²€ìƒ‰) ìµœì í™”
 * - ì„ ê±°ë²• ì¤€ìˆ˜
 */

'use strict';

const { getElectionStage } = require('../guidelines/legal');

// ============================================================================
// 7ê°€ì§€ ì½˜í…ì¸  êµ¬ì¡° ìœ í˜• ì •ì˜
// ============================================================================

const TITLE_TYPES = {
  // ìœ í˜• 1: êµ¬ì²´ì  ë°ì´í„° ê¸°ë°˜ (ì„±ê³¼ ë³´ê³ )
  DATA_BASED: {
    id: 'DATA_BASED',
    name: 'êµ¬ì²´ì  ë°ì´í„° ê¸°ë°˜',
    when: 'ì •ì±… ì™„ë£Œ, ì˜ˆì‚° í™•ë³´, ì‚¬ì—… ì™„ê³µ ë“± êµ¬ì²´ì  ì„±ê³¼ê°€ ìˆì„ ë•Œ',
    pattern: 'ìˆ«ì 2ê°œ ì´ìƒ + í•µì‹¬ í‚¤ì›Œë“œ',
    naverTip: '"ì–µ ì›", "ëª…", "%" ë“± êµ¬ì²´ì  ë‹¨ìœ„ê°€ ìˆìœ¼ë©´ AI ë¸Œë¦¬í•‘ ì¸ìš©ë¥  â†‘',
    good: [
      { title: 'ì²­ë…„ ì¼ìë¦¬ 274ëª… ì°½ì¶œ, ì§€ì›ê¸ˆ 85ì–µ ë‹¬ì„±', chars: 22, analysis: 'ìˆ«ì 2ê°œ(274ëª…, 85ì–µ) + í‚¤ì›Œë“œ ëª…í™•' },
      { title: 'ì£¼íƒ 234ê°€êµ¬ ë¦¬ëª¨ë¸ë§ ì§€ì› ì™„ë£Œ', chars: 17, analysis: 'êµ¬ì²´ì  ìˆ˜ëŸ‰ + ê²°ê³¼ ëª…ì‹œ' },
      { title: 'ë…¸í›„ ì‚°ì—…ë‹¨ì§€ ì¬ìƒ, êµ­ë¹„ 120ì–µ í™•ë³´', chars: 19, analysis: 'ì‚¬ì—…ëª… + ê¸ˆì•¡ + ê²°ê³¼' },
      { title: 'êµí†µ ì‹ í˜¸ë“± 15ê³³ ê°œì„ , ì‚¬ê³ ìœ¨ 40% ê°ì†Œ', chars: 21, analysis: 'ì‹œì„¤(15ê³³) + íš¨ê³¼(40%)' },
      { title: '2025ë…„ ìƒë°˜ê¸° ë¯¼ì› ì²˜ë¦¬ 3ì¼ ì´ë‚´ ë‹¬ì„±', chars: 21, analysis: 'ì‹œê°„ ëª…ì‹œ + êµ¬ì²´ì  ê¸°ì¤€' }
    ],
    bad: [
      { title: 'ì¢‹ì€ ì„±ê³¼ ê±°ë’€ìŠµë‹ˆë‹¤', problem: 'êµ¬ì²´ì  ì •ë³´ ì „ë¬´', fix: 'ì£¼íƒ 234ê°€êµ¬ ì§€ì› ì™„ë£Œ' },
      { title: 'ìµœì„ ì„ ë‹¤í–ˆìŠµë‹ˆë‹¤', problem: 'ì„±ê³¼ ë¯¸ì œì‹œ', fix: 'ë¯¼ì› 3ì¼ ì´ë‚´ ì²˜ë¦¬ìœ¨ 95%' },
      { title: 'ì˜ˆì‚° ë§ì´ í™•ë³´í–ˆì–´ìš”', problem: '"ë§ì´"ê°€ ëª¨í˜¸', fix: 'êµ­ë¹„ 120ì–µ í™•ë³´' }
    ]
  },

  // ìœ í˜• 2: ì§ˆë¬¸-í•´ë‹µ êµ¬ì¡° (AEO ìµœì í™”)
  QUESTION_ANSWER: {
    id: 'QUESTION_ANSWER',
    name: 'ì§ˆë¬¸-í•´ë‹µ êµ¬ì¡°',
    when: 'ì£¼ë¯¼ì´ ì‹¤ì œë¡œ ê²€ìƒ‰í•˜ëŠ” ì§ˆë¬¸ì— ë‹µí•  ë•Œ',
    pattern: '"ì–´ë–»ê²Œ", "ë¬´ì—‡ì„", "ì™œ", "ì–¼ë§ˆ" + ì§ˆë¬¸í˜•',
    naverTip: 'ì§ˆë¬¸í˜•ìœ¼ë¡œ ì‹œì‘í•˜ë©´ AI ë¸Œë¦¬í•‘ ì„ íƒë¥  3ë°°â†‘',
    good: [
      { title: 'ë¶„ë‹¹êµ¬ ì²­ë…„ ì£¼ê±°, ì›”ì„¸ ì§€ì› ì–¼ë§ˆê¹Œì§€?', chars: 19, analysis: 'ì§€ì—­ëª… + ì§ˆë¬¸í˜•' },
      { title: 'ì„±ë‚¨ êµí†µ ì²´ì¦, ì–´ë–»ê²Œ í’€ê¹Œ?', chars: 15, analysis: 'ì§€ì—­ + ë¬¸ì œ + ì§ˆë¬¸' },
      { title: 'ì–´ë¥´ì‹  ì¼ìë¦¬, ì–´ë–¤ í”„ë¡œê·¸ë¨ ìˆë‚˜?', chars: 18, analysis: 'ëŒ€ìƒ + ì •ì±… + ì§ˆë¬¸' },
      { title: '2025ë…„ ë³´ìœ¡ë£Œ, ì§€ì› ê¸°ì¤€ ë°”ë€Œì—ˆë‚˜?', chars: 19, analysis: 'ì •ì±…ëª… + ì§ˆë¬¸í˜• + ë³€í™” ì•”ì‹œ' },
      { title: 'ì „ì„¸ ì‚¬ê¸°, í”¼í•´ ë³´ìƒì€ ì–´ë–»ê²Œ?', chars: 16, analysis: 'ì‚¬íšŒë¬¸ì œ + í•´ê²°ì±… ì§ˆë¬¸' }
    ],
    bad: [
      { title: 'ì •ì±…ì— ëŒ€í•´ ì„¤ëª…ë“œë¦½ë‹ˆë‹¤', problem: 'ì§ˆë¬¸í˜• ì•„ë‹˜, ëª¨í˜¸', fix: 'ì²­ë…„ ì§€ì› ì •ì±…, ë¬´ì—‡ì´ ë‹¬ë¼ì¡Œë‚˜?' },
      { title: 'ì²­ë…„ì— ëŒ€í•œ ì •ì±…', problem: 'ê²€ìƒ‰ ì˜ë„ ë¯¸ì¶©ì¡±', fix: 'ì²­ë…„ ì°½ì—…, ëª‡ ë…„ ë¬´ì´ì ì§€ì›?' },
      { title: 'ê¶ê¸ˆí•œ ì ì„ í•´ê²°í•´ ë“œë¦½ë‹ˆë‹¤', problem: 'ë„ˆë¬´ ë²”ìš©ì ', fix: 'ì•„ì´ êµìœ¡ë¹„, ì§€ì› ê¸ˆì•¡ ì–¼ë§ˆ?' }
    ]
  },

  // ìœ í˜• 3: ë¹„êµÂ·ëŒ€ì¡° êµ¬ì¡° (ì„±ê³¼ ì¦ëª…)
  COMPARISON: {
    id: 'COMPARISON',
    name: 'ë¹„êµÂ·ëŒ€ì¡° êµ¬ì¡°',
    when: 'ì •ì±…ì˜ ë³€í™”, ê°œì„ , í•´ê²°ì„ ê°•ì¡°í•  ë•Œ',
    pattern: 'ì „í›„ ëŒ€ë¹„ ìˆ˜ì¹˜ + "â†’", "vs", "ëŒ€ë¹„"',
    naverTip: '"â†’", "ë‹¬ë¼ì¡Œë‹¤", "ê°œì„ " ë“±ì´ ê²€ìƒ‰ ì•Œê³ ë¦¬ì¦˜ ì„ í˜¸',
    good: [
      { title: 'ë¯¼ì› ì²˜ë¦¬ 14ì¼â†’3ì¼, 5ë°° ë¹¨ë¼ì¡Œì–´ìš”', chars: 19, analysis: 'ìˆ˜ì¹˜ ë³€í™” + íš¨ê³¼' },
      { title: 'ì²­ë…„ ê¸°ë³¸ì†Œë“ ì›” 30ë§Œâ†’50ë§Œì› í™•ëŒ€', chars: 19, analysis: 'ì •ì±…ëª… + ìˆ˜ì¹˜ ëŒ€ë¹„' },
      { title: 'êµí†µ ì‚¬ê³ ìœ¨, ì „ë…„ ëŒ€ë¹„ 40% ê°ì†Œ', chars: 18, analysis: 'ì§€í‘œ + ë¹„êµ ê¸°ì¤€ + ìˆ˜ì¹˜' },
      { title: 'ì“°ë ˆê¸° ì²˜ë¦¬ ë¹„ìš© 99ì–µâ†’65ì–µ ì ˆê°', chars: 18, analysis: 'êµ¬ì²´ì  ì ˆê°ì•¡' },
      { title: 'ì£¼ì°¨ì¥ ë¶€ì¡± ì§€ì—­, 12ê°œì›” ë§Œì— í•´ê²°', chars: 18, analysis: 'ë¬¸ì œ + ê¸°ê°„ + ê²°ê³¼' }
    ],
    bad: [
      { title: 'ì´ì „ë³´ë‹¤ ë‚˜ì•„ì¡Œì–´ìš”', problem: '"ì´ì „" ëª¨í˜¸', fix: 'ë¯¼ì› ì²˜ë¦¬ 14ì¼â†’3ì¼ ê°œì„ ' },
      { title: 'ë§ì´ ê°œì„ ë˜ì—ˆìŠµë‹ˆë‹¤', problem: '"ë§ì´" ê²€ì¦ ë¶ˆê°€', fix: 'êµí†µ ì‚¬ê³ ìœ¨ 40% ê°ì†Œ' },
      { title: 'ì‹œê°„ì´ ë‹¨ì¶•ë˜ì—ˆìŠµë‹ˆë‹¤', problem: 'ì–¼ë§ˆë‚˜?', fix: 'ë¯¼ì› ì²˜ë¦¬ 14ì¼â†’3ì¼ ë‹¨ì¶•' }
    ]
  },

  // ìœ í˜• 4: ì§€ì—­ ë§ì¶¤í˜• ì •ë³´ (ì´ˆì§€ì—­í™”)
  LOCAL_FOCUSED: {
    id: 'LOCAL_FOCUSED',
    name: 'ì§€ì—­ ë§ì¶¤í˜• ì •ë³´',
    when: 'íŠ¹ì • ë™Â·ë©´Â·ìì˜ ì£¼ë¯¼ì„ íƒ€ê²Ÿí•  ë•Œ',
    pattern: 'í–‰ì •êµ¬ì—­ëª…(ë™ ë‹¨ìœ„) + ì •ì±… + ìˆ«ì',
    naverTip: 'ë™ë‹¨ìœ„ í‚¤ì›Œë“œëŠ” ê²½ìŸë„ ë‚®ì•„ ìƒìœ„ë…¸ì¶œ ìœ ë¦¬',
    good: [
      { title: 'ë¶„ë‹¹êµ¬ ì •ìë™ ë„ì‹œê°€ìŠ¤, ê¸°ê¸ˆ 70ì–µ í™•ë³´', chars: 21, analysis: 'ì§€ì—­ëª…(ë™) + ì •ì±… + ìˆ«ì' },
      { title: 'ìˆ˜ì§€êµ¬ í’ë•ì²œë™ í•™êµ ì‹ ì„¤, 9ì›” ê°œêµ', chars: 19, analysis: 'ì§€ì—­ëª…(ë™) + ì‚¬ì—…ëª… + ì¼ì •' },
      { title: 'ì„±ë‚¨ì‹œ ì¤‘ì›êµ¬ ë³´ìœ¡ë£Œ, ì›” 15ë§Œì› ì¶”ê°€', chars: 20, analysis: 'í–‰ì •êµ¬ì—­ + ì •ì±… + ì§€ì›ì•¡' },
      { title: 'ìš©ì¸ì‹œ ê¸°í¥êµ¬ ìš”ì–‘ì›, ì‹ ì²­ ë§ˆê° 1ì£¼', chars: 19, analysis: 'ì§€ì—­ëª… + ì‹œì„¤ + ê¸´ê¸‰ì„±' },
      { title: 'ì˜í†µêµ¬ ê´‘êµë™ êµí†µ, 6ê°œì›”ê°„ 35% ê°œì„ ', chars: 21, analysis: 'ì§€ì—­ëª… + ì§€í‘œ + ê¸°ê°„ + íš¨ê³¼' }
    ],
    bad: [
      { title: 'ìš°ë¦¬ ì§€ì—­ì„ ìœ„í•´ ë…¸ë ¥í•©ë‹ˆë‹¤', problem: 'ì§€ì—­ëª… ì—†ìŒ', fix: 'ë¶„ë‹¹êµ¬ ì •ìë™ ë„ì‹œê°€ìŠ¤ 70ì–µ' },
      { title: 'ì§€ì—­ ì •ì±… ì•ˆë‚´', problem: 'ì–´ëŠ ì§€ì—­? ì–´ë–¤ ì •ì±…?', fix: 'ì„±ë‚¨ì‹œ ì¤‘ì›êµ¬ ë³´ìœ¡ë£Œ ì›” 15ë§Œì›' },
      { title: 'ë™ë„¤ ì£¼ì°¨ì¥ ë¬¸ì œ', problem: 'ì§€ì—­ëª…Â·í•´ê²°ì±… ë¶€ì¬', fix: 'ë¶„ë‹¹êµ¬ ì •ìë™ ì£¼ì°¨ì¥ 50ë©´ ì¶”ê°€' }
    ]
  },

  // ìœ í˜• 5: ì „ë¬¸ ì§€ì‹ ê³µìœ  (ë²•ì•ˆÂ·ì¡°ë¡€Â·ì •ì±…)
  EXPERT_KNOWLEDGE: {
    id: 'EXPERT_KNOWLEDGE',
    name: 'ì „ë¬¸ ì§€ì‹ ê³µìœ ',
    when: 'ë²•ì•ˆ ë°œì˜, ì¡°ë¡€ ì œì •, ì •ì±… ë¶„ì„ ê¸€ì„ ì“¸ ë•Œ',
    pattern: '"ë²•ì•ˆ", "ì¡°ë¡€", "ì œë„" + í•µì‹¬ ë‚´ìš©',
    naverTip: 'ì „ë¬¸ ìš©ì–´ë¡œ E-E-A-T ê°•ì¡°, ì¼ë°˜ì¸ë„ ê²€ìƒ‰í•˜ëŠ” í‚¤ì›Œë“œ',
    good: [
      { title: 'ì²­ë…„ ê¸°ë³¸ì†Œë“ë²• ë°œì˜, ì›” 50ë§Œì› ì§€ì›ì•ˆ', chars: 20, analysis: 'ë²•ì•ˆëª… + ì •ì±…ë‚´ìš© + ê¸ˆì•¡' },
      { title: 'ì£¼ì°¨ì¥ ì„¤ì¹˜ ì˜ë¬´ ì¡°ë¡€ ê°œì • ì¶”ì§„', chars: 17, analysis: 'ì¡°ë¡€ëª… + ë™ì‘(ê°œì •)' },
      { title: 'ì „ì„¸ ì‚¬ê¸° í”¼í•´ì ë³´í˜¸ë²•, í•µì‹¬ 3ê°€ì§€', chars: 19, analysis: 'ë²•ì•ˆëª… + ìš”ì•½ í¬ì¸íŠ¸' },
      { title: 'ì•¼ê°„ ìƒì  CCTV ì˜ë¬´í™” ì¡°ë¡€ì•ˆ í†µê³¼', chars: 18, analysis: 'ì •ì±…ë‚´ìš© + ì¡°ë¡€í˜•íƒœ + ê²°ê³¼' },
      { title: 'ìì˜ì—…ì ì‹ ìš©ëŒ€ì¶œ, ê¸ˆë¦¬ ì¸í•˜ ì •ì±… ì¶”ì§„', chars: 20, analysis: 'ëŒ€ìƒ + ì •ì±… + êµ¬ì²´ì„±' }
    ],
    bad: [
      { title: 'ë²•ì•ˆì„ ë°œì˜í–ˆìŠµë‹ˆë‹¤', problem: '"ë²•ì•ˆ" ëª¨í˜¸', fix: 'ì²­ë…„ ê¸°ë³¸ì†Œë“ë²• ë°œì˜, ì›” 50ë§Œì›' },
      { title: 'ì¡°ë¡€ì— ëŒ€í•´ ì„¤ëª…ë“œë¦½ë‹ˆë‹¤', problem: 'ì¡°ë¡€ëª… ë¶€ì¬', fix: 'ì£¼ì°¨ì¥ ì„¤ì¹˜ ì˜ë¬´ ì¡°ë¡€ ê°œì •' },
      { title: 'ì œë„ ê°œì„  ê´€ë ¨ ì œì•ˆ', problem: '"ì œë„ ê°œì„ " ì¶”ìƒì ', fix: 'ì „ì„¸ ì‚¬ê¸° í”¼í•´ì ë³´í˜¸ë²• ë°œì˜' }
    ]
  },

  // ìœ í˜• 6: ì‹œê°„ ì¤‘ì‹¬ ì‹ ë¢°ì„± (ì •ê¸° ë³´ê³ )
  TIME_BASED: {
    id: 'TIME_BASED',
    name: 'ì‹œê°„ ì¤‘ì‹¬ ì‹ ë¢°ì„±',
    when: 'ì›”ê°„ ë³´ê³ ì„œ, ë¶„ê¸° ë¦¬í¬íŠ¸, ì—°ê°„ ì„±ê³¼ ì •ë¦¬ ì‹œ',
    pattern: '"2025ë…„", "ìƒë°˜ê¸°", "ì›”ê°„" + í˜•ì‹(ë³´ê³ ì„œ/ë¦¬í¬íŠ¸)',
    naverTip: 'ì‹œê°„ ëª…ì‹œê°€ ê²€ìƒ‰ ì‹ ì„ ë„ ì‹ í˜¸ë¡œ ì‘ìš©',
    good: [
      { title: '2025ë…„ ìƒë°˜ê¸° ì˜ì • ë³´ê³ ì„œ, 5ëŒ€ ì„±ê³¼', chars: 20, analysis: 'ì‹œê°„ ëª…ì‹œ + í˜•ì‹ + ì„±ê³¼ìˆ˜' },
      { title: '6ì›” ë¯¼ì› ì²˜ë¦¬ ë¦¬í¬íŠ¸, 1,234ê±´ í•´ê²°', chars: 20, analysis: 'ì›”ëª… + í˜•ì‹ + êµ¬ì²´ì  ìˆ˜ì¹˜' },
      { title: '2025ë…„ 1ë¶„ê¸° ì˜ˆì‚° ì§‘í–‰ í˜„í™© ê³µê°œ', chars: 19, analysis: 'ê¸°ê°„ + í•­ëª©ëª… + ê³µê°œ ì‹ í˜¸' },
      { title: 'ìƒë°˜ê¸° ì£¼ë¯¼ ì˜ê²¬ ë¶„ì„, 88ê±´ ë°˜ì˜ ì¶”ì§„', chars: 20, analysis: 'ê¸°ê°„ + í™œë™ + ìˆ«ì' },
      { title: 'ì›”ê°„ ì˜ì • ë‰´ìŠ¤ë ˆí„° (7ì›”í˜¸) ë°°í¬', chars: 18, analysis: 'ì‹œê°„ ëª…ì‹œ + í˜•ì‹ëª…' }
    ],
    bad: [
      { title: 'ë³´ê³ ì„œë¥¼ ì˜¬ë¦½ë‹ˆë‹¤', problem: 'ì‹œê°„ ë¯¸ëª…ì‹œ', fix: '2025ë…„ ìƒë°˜ê¸° ì˜ì • ë³´ê³ ì„œ' },
      { title: 'ìµœê·¼ í™œë™ì„ ì •ë¦¬í–ˆìŠµë‹ˆë‹¤', problem: '"ìµœê·¼" ì• ë§¤', fix: '6ì›” ë¯¼ì› ì²˜ë¦¬ ë¦¬í¬íŠ¸, 1,234ê±´' },
      { title: 'ë¶„ê¸°ë³„ í˜„í™©ì…ë‹ˆë‹¤', problem: 'ì–´ëŠ ë¶„ê¸°?', fix: '2025ë…„ 1ë¶„ê¸° ì˜ˆì‚° ì§‘í–‰ í˜„í™©' }
    ]
  },

  // ìœ í˜• 7: ì •ê³„ ì´ìŠˆÂ·ë¶„ì„ (êµ­ê°€ ì •ì±…Â·ê±°ì‹œ)
  ISSUE_ANALYSIS: {
    id: 'ISSUE_ANALYSIS',
    name: 'ì •ê³„ ì´ìŠˆÂ·ë¶„ì„',
    when: 'ì •ê³„ ì´ìŠˆ, êµ­ê°€ ì •ì±… ë…¼í‰, ì œë„ ê°œí˜ ë¶„ì„ ì‹œ',
    pattern: 'ì´ìŠˆëª… + "ë¬¸ì œ", "ëŒ€ì•ˆ", "ë¶„ì„" (ì§€ì—­ëª… ë¶ˆí•„ìš”)',
    naverTip: 'ì •ì¹˜ì¸ì´ ì•„ë‹Œ ì¼ë°˜ ê²€ìƒ‰ìë„ ì°¾ëŠ” ë‰´ìŠ¤Â·ì •ì±… í‚¤ì›Œë“œ',
    good: [
      { title: 'ì§€ë°© ë¶„ê¶Œ ê°œí˜, ì‹¤ì œë¡œ ë­ê°€ ë‹¬ë¼ì§ˆê¹Œ?', chars: 19, analysis: 'ì´ìŠˆëª… + ì§ˆë¬¸í˜•' },
      { title: 'ì •ì¹˜ ìê¸ˆ íˆ¬ëª…ì„±, ì–´ë–»ê²Œ ê°œì„ í• ê¹Œ?', chars: 18, analysis: 'ì´ìŠˆ + ì§ˆë¬¸í˜•' },
      { title: 'ì–‘ê·¹í™” ë¬¸ì œ, 4ëŒ€ ëŒ€ì•ˆ ì œì‹œ', chars: 14, analysis: 'ì‚¬íšŒ ì´ìŠˆ + ëŒ€ì•ˆ ìˆ˜' },
      { title: 'êµìœ¡ ê²©ì°¨, ì¬ì • íˆ¬ìë¡œ ë­ê°€ ë‹¬ë¼ì§ˆê¹Œ?', chars: 20, analysis: 'ì‚¬íšŒ ë¬¸ì œ + ì ‘ê·¼ë²• + ì§ˆë¬¸' },
      { title: 'ì„ ê±° ì œë„ ê°œí˜, ì™œ ì‹œê¸‰í•œê°€?', chars: 15, analysis: 'ì œë„ëª… + ì •ë‹¹ì„± ì§ˆë¬¸' }
    ],
    bad: [
      { title: 'ì •ì¹˜ í˜„ì‹¤ì— ëŒ€í•´ ìƒê°í•´ ë´…ì‹œë‹¤', problem: 'êµ¬ì²´ì  ì´ìŠˆ ë¶€ì¬', fix: 'ì§€ë°© ë¶„ê¶Œ ê°œí˜, ë­ê°€ ë‹¬ë¼ì§ˆê¹Œ?' },
      { title: 'ë¬¸ì œê°€ ë§ìŠµë‹ˆë‹¤', problem: 'ì–´ë–¤ ë¬¸ì œ?', fix: 'ì–‘ê·¹í™” ë¬¸ì œ, 4ëŒ€ ëŒ€ì•ˆ ì œì‹œ' },
      { title: 'ì œë„ë¥¼ ê°œì„ í•´ì•¼ í•©ë‹ˆë‹¤', problem: 'ì–´ë–¤ ì œë„? ì–´ë–»ê²Œ?', fix: 'ì„ ê±° ì œë„ ê°œí˜, ì™œ ì‹œê¸‰í•œê°€?' }
    ]
  }
};

// ============================================================================
// ì½˜í…ì¸  êµ¬ì¡° ìë™ ê°ì§€
// ============================================================================

/**
 * ë³¸ë¬¸ ë‚´ìš©ì„ ë¶„ì„í•˜ì—¬ ì í•©í•œ ì œëª© ìœ í˜•ì„ ê°ì§€
 * @param {string} contentPreview - ë³¸ë¬¸ ë¯¸ë¦¬ë³´ê¸°
 * @param {string} category - ì¹´í…Œê³ ë¦¬ (ì°¸ê³ ìš©)
 * @returns {string} - ì¶”ì²œ ìœ í˜• ID
 */
function detectContentType(contentPreview, category) {
  const text = contentPreview.toLowerCase();

  // ìˆ«ì íŒ¨í„´ ê°ì§€
  const hasNumbers = /\d+ì–µ|\d+ë§Œì›|\d+%|\d+ëª…|\d+ê±´|\d+ê°€êµ¬|\d+ê³³/.test(contentPreview);
  const hasComparison = /â†’|ì—ì„œ|ìœ¼ë¡œ|ì „ë…„|ëŒ€ë¹„|ê°œì„ |ê°ì†Œ|ì¦ê°€|ë³€í™”/.test(text);
  const hasQuestion = /\?|ì–´ë–»ê²Œ|ë¬´ì—‡|ì™œ|ì–¼ë§ˆ|ì–¸ì œ/.test(text);
  const hasLegalTerms = /ë²•ì•ˆ|ì¡°ë¡€|ë²•ë¥ |ì œë„|ê°œì •|ë°œì˜|í†µê³¼/.test(text);
  const hasTimeTerms = /2025ë…„|ìƒë°˜ê¸°|í•˜ë°˜ê¸°|ë¶„ê¸°|ì›”ê°„|ì—°ê°„|ë³´ê³ ì„œ|ë¦¬í¬íŠ¸/.test(text);
  const hasLocalTerms = /ë™\s|êµ¬\s|ì‹œ\s|ì\s|ë©´\s|ë¦¬\s/.test(contentPreview);
  const hasIssueTerms = /ê°œí˜|ë¶„ê¶Œ|ì–‘ê·¹í™”|ê²©ì°¨|íˆ¬ëª…ì„±|ë¬¸ì œì |ëŒ€ì•ˆ/.test(text);

  // ìš°ì„ ìˆœìœ„ ê¸°ë°˜ ìœ í˜• ê²°ì •
  if (hasTimeTerms && (text.includes('ë³´ê³ ') || text.includes('ë¦¬í¬íŠ¸') || text.includes('í˜„í™©'))) {
    return 'TIME_BASED';
  }
  if (hasLegalTerms) {
    return 'EXPERT_KNOWLEDGE';
  }
  if (hasComparison && hasNumbers) {
    return 'COMPARISON';
  }
  if (hasQuestion) {
    return 'QUESTION_ANSWER';
  }
  if (hasNumbers && !hasIssueTerms) {
    return 'DATA_BASED';
  }
  if (hasIssueTerms && !hasLocalTerms) {
    return 'ISSUE_ANALYSIS';
  }
  if (hasLocalTerms) {
    return 'LOCAL_FOCUSED';
  }

  // ì¹´í…Œê³ ë¦¬ ê¸°ë°˜ í´ë°±
  const categoryMapping = {
    'activity-report': 'DATA_BASED',
    'policy-proposal': 'EXPERT_KNOWLEDGE',
    'local-issues': 'LOCAL_FOCUSED',
    'current-affairs': 'ISSUE_ANALYSIS',
    'daily-communication': 'QUESTION_ANSWER'
  };

  return categoryMapping[category] || 'DATA_BASED';
}

// ============================================================================
// ì„ ê±°ë²• ì¤€ìˆ˜ ì§€ì‹œë¬¸
// ============================================================================

function getElectionComplianceInstruction(status) {
  const electionStage = getElectionStage(status);
  const isPreCandidate = electionStage?.name === 'STAGE_1';

  if (!isPreCandidate) return '';

  return `
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âš ï¸ ì„ ê±°ë²• ì¤€ìˆ˜ (í˜„ì¬ ìƒíƒœ: ${status} - ì˜ˆë¹„í›„ë³´ ë“±ë¡ ì´ì „)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âŒ ì ˆëŒ€ ê¸ˆì§€ í‘œí˜„:
â€¢ "ì•½ì†", "ê³µì•½", "ì•½ì†ë“œë¦½ë‹ˆë‹¤"
â€¢ "ë‹¹ì„ ë˜ë©´", "ë‹¹ì„  í›„"
â€¢ "~í•˜ê² ìŠµë‹ˆë‹¤" (ê³µì•½ì„± ë¯¸ë˜ ì•½ì†)
â€¢ "ì§€ì§€í•´ ì£¼ì‹­ì‹œì˜¤"

âœ… í—ˆìš© í‘œí˜„:
â€¢ "ì •ì±… ë°©í–¥", "ì •ì±… ì œì‹œ", "ë¹„ì „ ê³µìœ "
â€¢ "ì—°êµ¬í•˜ê² ìŠµë‹ˆë‹¤", "ë…¸ë ¥í•˜ê² ìŠµë‹ˆë‹¤"
â€¢ "ì¶”ì§„", "ì¶”êµ¬", "ê²€í† "

ì˜ˆì‹œ:
âŒ "ì²­ë…„ ê¸°ë³¸ì†Œë“, ê¼­ ì•½ì†ë“œë¦¬ê² ìŠµë‹ˆë‹¤"
âœ… "ì²­ë…„ ê¸°ë³¸ì†Œë“, ì •ì±… ë°©í–¥ ì œì‹œ"
`;
}

// ============================================================================
// SEO í‚¤ì›Œë“œ ì‚½ì… ì „ëµ (ìœ„ì¹˜ë³„ ê°€ì¤‘ì¹˜)
// ============================================================================

const KEYWORD_POSITION_GUIDE = {
  front: {
    range: '0-8ì',
    weight: '100%',
    use: 'ì§€ì—­ëª…, ì •ì±…ëª…, í•µì‹¬ ì£¼ì œ',
    example: '"ë¶„ë‹¹êµ¬ ì²­ë…„ ê¸°ë³¸ì†Œë“" â†’ "ë¶„ë‹¹êµ¬"ê°€ ê²€ìƒ‰ ê°€ì¤‘ì¹˜ ìµœê³ '
  },
  middle: {
    range: '9-17ì',
    weight: '80%',
    use: 'êµ¬ì²´ì  ìˆ˜ì¹˜, LSI í‚¤ì›Œë“œ',
    example: '"ì›” 50ë§Œì›", "ì£¼ê±°Â·ì¼ìë¦¬"'
  },
  end: {
    range: '18-25ì',
    weight: '60%',
    use: 'í–‰ë™ ìœ ë„, ê¸´ê¸‰ì„±, ì‹ ë¢°ì„± ì‹ í˜¸',
    example: '"ì‹ ì²­ ë§ˆê° 3ì¼ ì „", "5ëŒ€ ì„±ê³¼"'
  }
};

/**
 * í‚¤ì›Œë“œ ì‚½ì… ì „ëµ ì§€ì‹œë¬¸ ìƒì„±
 */
function getKeywordStrategyInstruction(userKeywords, keywords) {
  const hasUserKeywords = userKeywords && userKeywords.length > 0;
  const primaryKw = hasUserKeywords ? userKeywords[0] : (keywords?.[0] || '');
  const secondaryKw = hasUserKeywords
    ? (userKeywords[1] || keywords?.[0] || '')
    : (keywords?.[1] || '');

  return `
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ”‘ SEO í‚¤ì›Œë“œ ì‚½ì… ì „ëµ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“ **ì•ìª½ 1/3 ë²•ì¹™** (ê°€ì¥ ì¤‘ìš”!)
ë„¤ì´ë²„ëŠ” ì œëª© ì• 8-10ìë¥¼ ê°€ì¥ ì¤‘ìš”í•˜ê²Œ í‰ê°€í•©ë‹ˆë‹¤.
â†’ í•µì‹¬ í‚¤ì›Œë“œëŠ” ë°˜ë“œì‹œ ì œëª© ì‹œì‘ ë¶€ë¶„ì—!

âŒ "ìš°ë¦¬ ì§€ì—­ ì²­ë…„ë“¤ì„ ìœ„í•œ ì²­ë…„ ê¸°ë³¸ì†Œë“"
âœ… "ì²­ë…„ ê¸°ë³¸ì†Œë“, ë¶„ë‹¹êµ¬ ì›” 50ë§Œì› ì§€ì›"

ğŸ“Š **í‚¤ì›Œë“œ ë°€ë„: ìµœì†Œ 1ê°œ, ìµœëŒ€ 3ê°œ**
â€¢ ìµœì : 2ê°œ (ê°€ì¥ ìì—°ìŠ¤ëŸ½ê³  íš¨ê³¼ì )
â€¢ 4ê°œ ì´ìƒ: ìŠ¤íŒ¸ìœ¼ë¡œ íŒë‹¨, CTR ê°ì†Œ

âœ… "ë¶„ë‹¹êµ¬ ì²­ë…„ ê¸°ë³¸ì†Œë“, ì›” 50ë§Œì›" (2ê°œ: ë¶„ë‹¹êµ¬, ì²­ë…„ ê¸°ë³¸ì†Œë“)
âŒ "ë¶„ë‹¹êµ¬ ì •ìë™ ì²­ë…„ ê¸°ë³¸ì†Œë“ ì›” 50ë§Œì› ì§€ì›" (4ê°œ, ì–´ìƒ‰)

ğŸ“ **ìœ„ì¹˜ë³„ ë°°ì¹˜ ì „ëµ**
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [0-8ì]     â”‚ [9-17ì]      â”‚ [18-25ì]   â”‚
â”‚ ì§€ì—­/ì •ì±…ëª…  â”‚ ìˆ˜ì¹˜/LSI     â”‚ í–‰ë™/ê¸´ê¸‰ì„±  â”‚
â”‚ ê°€ì¤‘ì¹˜ 100% â”‚ ê°€ì¤‘ì¹˜ 80%   â”‚ ê°€ì¤‘ì¹˜ 60%  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

${primaryKw ? `**1ìˆœìœ„ í‚¤ì›Œë“œ**: "${primaryKw}" â†’ ì œëª© ì• 8ì ì´ë‚´ ë°°ì¹˜` : ''}
${secondaryKw ? `**2ìˆœìœ„ í‚¤ì›Œë“œ**: "${secondaryKw}" â†’ ì œëª© ì¤‘ì•™ ë°°ì¹˜` : ''}

ğŸ”„ **ë™ì˜ì–´ í™œìš©** (ë°˜ë³µ ë°©ì§€)
â€¢ ì§€ì› â†’ ì§€ì›ê¸ˆ, ë³´ì¡°ê¸ˆ, í˜œíƒ
â€¢ ë¬¸ì œ â†’ í˜„ì•ˆ, ê³¼ì œ, ì–´ë ¤ì›€
â€¢ í•´ê²° â†’ ê°œì„ , ì™„í™”, í•´ì†Œ
`;
}

// ============================================================================
// í”„ë¡¬í”„íŠ¸ ë¹Œë”
// ============================================================================

/**
 * ë³¸ë¬¸ ë‚´ìš© ê¸°ë°˜ ì œëª© ìƒì„± í”„ë¡¬í”„íŠ¸ë¥¼ ë¹Œë“œí•©ë‹ˆë‹¤
 */
function buildTitlePrompt({ contentPreview, backgroundText, topic, fullName, keywords, userKeywords, category, subCategory, status }) {
  // 1. ì½˜í…ì¸  ìœ í˜• ìë™ ê°ì§€
  const detectedTypeId = detectContentType(contentPreview, category);
  const primaryType = TITLE_TYPES[detectedTypeId];

  // 2. ì„ ê±°ë²• ì¤€ìˆ˜ ì§€ì‹œë¬¸
  const electionCompliance = getElectionComplianceInstruction(status);

  // 3. í‚¤ì›Œë“œ ì „ëµ ì§€ì‹œë¬¸
  const keywordStrategy = getKeywordStrategyInstruction(userKeywords, keywords);

  // 4. Few-shot ì˜ˆì‹œ êµ¬ì„±
  const goodExamples = primaryType.good
    .map((ex, i) => `${i + 1}. "${ex.title}" (${ex.chars}ì)\n   â†’ ${ex.analysis}`)
    .join('\n');

  const badExamples = primaryType.bad
    .map((ex, i) => `${i + 1}. âŒ "${ex.title}"\n   ë¬¸ì œ: ${ex.problem}\n   âœ… ìˆ˜ì •: "${ex.fix}"`)
    .join('\n\n');

  // 5. í‚¤ì›Œë“œ ì²˜ë¦¬ (í‘œì‹œìš©)
  const primaryKeywords = userKeywords && userKeywords.length > 0
    ? userKeywords.slice(0, 3).join(', ')
    : '';
  const secondaryKeywords = keywords
    ? keywords.filter(k => !userKeywords?.includes(k)).slice(0, 3).join(', ')
    : '';

  return `ë‹¹ì‹ ì€ ë„¤ì´ë²„ ë¸”ë¡œê·¸ ì œëª© ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì•„ë˜ ê·œì¹™ì„ ì—„ê²©íˆ ë”°ë¼ ì œëª©ì„ ìƒì„±í•˜ì„¸ìš”.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“ ì ˆëŒ€ ê·œì¹™: 25ì ì´ë‚´
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â€¢ ìµœì : 15~22ì (ê°€ì¥ ë†’ì€ í´ë¦­ë¥ )
â€¢ 25ì ì´ˆê³¼ ì‹œ ë„¤ì´ë²„ ê²€ìƒ‰ê²°ê³¼ì—ì„œ ì˜ë¦¼
â€¢ ì‘ì„± í›„ ë°˜ë“œì‹œ ê¸€ì ìˆ˜ í™•ì¸!
${electionCompliance}
${keywordStrategy}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ¯ ê°ì§€ëœ ì½˜í…ì¸  ìœ í˜•: ${primaryType.name}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

**ì‚¬ìš© ì‹œì **: ${primaryType.when}
**ì œëª© íŒ¨í„´**: ${primaryType.pattern}
**ë„¤ì´ë²„ ìµœì í™”**: ${primaryType.naverTip}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… ì¢‹ì€ ì˜ˆì‹œ (ì´ íŒ¨í„´ì„ ë”°ë¼í•˜ì„¸ìš”)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
${goodExamples}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âŒ ë‚˜ìœ ì˜ˆì‹œ â†’ âœ… ìˆ˜ì • ë°©ë²•
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
${badExamples}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“ ë³¸ë¬¸ ì •ë³´
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
**ì£¼ì œ**: ${topic}
**ì‘ì„±ì**: ${fullName}

**ë³¸ë¬¸ ë¯¸ë¦¬ë³´ê¸°**:
${contentPreview.substring(0, 800)}

**ë°°ê²½ì •ë³´**:
${backgroundText ? backgroundText.substring(0, 300) : '(ì—†ìŒ)'}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸš¨ ìµœì¢… ì¶œë ¥ ê·œì¹™
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
1. **25ì ì´ë‚´** (í•„ìˆ˜!)
2. **í•µì‹¬ í‚¤ì›Œë“œ ì• 8ì ë°°ì¹˜** (ì•ìª½ 1/3 ë²•ì¹™)
3. ìˆ«ì/êµ¬ì²´ì„± í¬í•¨ (ê°€ëŠ¥í•˜ë©´)
4. ë¶€ì œëª©(-, :) ì‚¬ìš© ê¸ˆì§€
5. "~ì— ëŒ€í•œ", "~ê´€ë ¨" ë¶ˆí•„ìš” í‘œí˜„ ì œê±°
6. í‚¤ì›Œë“œ ìµœëŒ€ 3ê°œ (2ê°œ ìµœì )

**ì¶œë ¥**: ìˆœìˆ˜í•œ ì œëª© í…ìŠ¤íŠ¸ë§Œ. ë”°ì˜´í‘œ, ì„¤ëª…, ê¸€ììˆ˜ í‘œì‹œ ì—†ì´.

ì œëª©:`;
}

// ============================================================================
// ìœ í˜•ë³„ ì œëª© ìƒì„± (íŠ¹ì • ìœ í˜• ê°•ì œ ì‹œ)
// ============================================================================

/**
 * íŠ¹ì • ìœ í˜•ìœ¼ë¡œ ì œëª©ì„ ìƒì„±í•˜ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©
 * @param {string} typeId - TITLE_TYPESì˜ í‚¤
 * @param {Object} params - buildTitlePromptì™€ ë™ì¼í•œ íŒŒë¼ë¯¸í„°
 */
function buildTitlePromptWithType(typeId, params) {
  // ì›ë³¸ detectContentTypeì„ ì˜¤ë²„ë¼ì´ë“œ
  const originalDetect = detectContentType;
  const overriddenDetect = () => typeId;

  // ì„ì‹œë¡œ êµì²´ í›„ í”„ë¡¬í”„íŠ¸ ìƒì„±
  const prompt = buildTitlePrompt({
    ...params,
    // ë‚´ë¶€ì ìœ¼ë¡œ typeId ê°•ì œ
    _forcedType: typeId
  });

  return prompt;
}

// ============================================================================
// Exports
// ============================================================================

module.exports = {
  buildTitlePrompt,
  buildTitlePromptWithType,
  detectContentType,
  TITLE_TYPES,
  KEYWORD_POSITION_GUIDE,
  getElectionComplianceInstruction,
  getKeywordStrategyInstruction
};
